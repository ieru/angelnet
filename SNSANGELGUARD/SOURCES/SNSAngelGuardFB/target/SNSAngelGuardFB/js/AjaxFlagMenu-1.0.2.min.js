/**AjaxFlagMenu v1.0.2 is a simple vertical menu jQuery plugin (inspired from facebook) 2010/2011
 * @author Seddiki Mohammed <seddikimohammed@gmail.com>
 * @since 2010/2011
 * @Licence GNU GPL
 * 
 * version 1.0.2 min
 * */
(function($, document) {
    var titleFbList;
    var titleAngelSettAng;

    $.fn.AjaxFlagMenu = function(Options) {
        var LastSelectedItem = null;
        var titleFbList = null;
        var titleAngelSettAng = null;
        var titleName = null;
        var titleEmail = null;
        var menSave = null;
        var menWait = null;
        var menAviso = null;
        var menWarnings = null;



        function AjaxFlagMenuItem(_Title, _onOutIcon, _onClickIcon, _HtmlStatusContent, _url, _data) {

            var Title = $("<td>" + _Title + "</td>");
            Title.attr("width", "60%");
            var Icon = $('<td><img /></td>');
            Icon.attr("width", "10%");
            var HtmlStatusContent = $("<td><div>" + _HtmlStatusContent + "</div></td>");
            HtmlStatusContent.attr("width", "30%");
            var _AjaxFlagMenuItem = $("<li><table><tr></tr></table></li>");
            _AjaxFlagMenuItem.find("table").attr("border", "0");
            _AjaxFlagMenuItem.find("table").attr("width", "230px");
            _AjaxFlagMenuItem.attr("title", Title.text());
            _AjaxFlagMenuItem.find("table").find("tr").append(Icon);
            _AjaxFlagMenuItem.find("table").find("tr").append(Title);
            _AjaxFlagMenuItem.find("table").find("tr").append(HtmlStatusContent);
            _AjaxFlagMenuItem.css("cursor", "pointer");
            _AjaxFlagMenuItem.css("padding", "1px");
            this.jQueryObject = _AjaxFlagMenuItem;

            this.setOnOutStatus = function() {
                setIcon(_onOutIcon);
                setAjaxFlagMenuItemClass(Options.onOutClass);
                setHtmlStatusContentClass(Options.hscClickClass);
            };

            this.isClicked = function() {
                return _AjaxFlagMenuItem.hasClass(Options.onClickClass);
            };

            this.sethscCorner = function() {
                if (_HtmlStatusContent != '') {
                    HtmlStatusContent.find("div").corner("4px");
                }
            };

            function setIcon(img) {
                Icon.find("img").attr("src", img);
            }
            function setAjaxFlagMenuItemClass(_class) {
                _AjaxFlagMenuItem.attr("class", _class);
            }
            function setHtmlStatusContentClass(_class) {
                if (_HtmlStatusContent != '') {
                    HtmlStatusContent.find("div").attr("class", _class);
                }
            }
            function setHtmlStatusContent(HtmlContent) {
                HtmlStatusContent.html(HtmlContent);
            }
            _AjaxFlagMenuItem.mouseover(function() {
                if (!_AjaxFlagMenuItem.hasClass(Options.onClickClass)) {
                    setAjaxFlagMenuItemClass(Options.onOverClass);
                    _AjaxFlagMenuItem.uncorner();
                }
            });
            _AjaxFlagMenuItem.mouseout(function() {
                if (!_AjaxFlagMenuItem.hasClass(Options.onClickClass)) {
                    setAjaxFlagMenuItemClass(Options.onOutClass);
                }
            });
            function cargarPagina(listAngels, strFbList, strSubAng) {
                cargarListaAngels(listAngels, strSubAng);
                cargarLista(strFbList);
            }

            function cargarPaginaParent(listAngels, strFbList, strSubAng) {
                window.parent.cargarListaAngels(listAngels, strSubAng);
                window.parent.cargarListaParent(strFbList);
            }

            function cargarLista(strFbList) {
                var array = strFbList.split(";");

                $(document).ready(function() {
                    //id(ul id),width,height(element height),row(elements in row)
                    $.fcbkListSelection("#fcbklist", "675", "50", "3", array[0], array[1], array[2]);
                });
            }

            function Carga(url1, inicio, strFbList, strSubAng, menSave, menWait)
            {
                var objeto;
                if (url1 == '../SNSAngelGuardFB/settingsSNSAngelGuard_Angels.jsp') {
                    saveSelectionAngels();
                    objeto = $.ajax({
                        url: url1,
                        type: 'POST',
                        data: reloadAngels(),
                        async: true,
                        success: function() {
                            cargarobjeto(objeto);
                            cargarPagina(_data, strFbList, strSubAng);
                        },
                        complete: function() {
                            loadAngelSelects($("#hdAngels").val());
                            pintarTablaConGoogle(document.getElementById('hdAngelsGoogleSelected').value, '');
                            loadContactsEd(menSave, menWait);
                            habilitarGuardar();
                            cerrarLoader();
                        }
                    });
                } else {
                    objeto = $.ajax({
                        url: url1,
                        type: 'POST',
                        data: loadAngels(),
                        async: true,
                        success: function() {
                            cargarobjeto(objeto);
                        },
                        complete: function() {
                            habilitarGuardar();
                            cerrarLoader();
                        }
                    });
                }
            }

            function cargarobjetoParent(objeto)
            {
                if (objeto.readyState == 3) {
                    window.parent.getElementById(Options.ajaxContent).innerHTML = '<img src="../SNSAngelGuardFB/resources/load.gif" alt="cargando" />';
                    $("#" + Options.ajaxContent).html('<img src="../SNSAngelGuardFB/resources/load.gif" alt="cargando" />');
                }
                if (objeto.readyState == 4) {
                    if (objeto.status == 200) {
                        window.parent.getElementById(Options.ajaxContent).innerHTML = objeto.responseText;
                        $("#" + Options.ajaxContent).html(objeto.responseText);
                        setHtmlStatusContent('<div>' + _HtmlStatusContent + '</div>');
                        setHtmlStatusContentClass(Options.hscOutClass);
                        HtmlStatusContent.find("div").corner("4px");
                    }
                }
            }

            function cargarobjeto(objeto)
            {
                if (objeto.readyState == 3) {
                    document.getElementById(Options.ajaxContent).innerHTML = '<img src="../SNSAngelGuardFB/resources/load.gif" alt="cargando" />';
                    $("#" + Options.ajaxContent).html('<img src="../SNSAngelGuardFB/resources/load.gif" alt="cargando" />');
                }
                if (objeto.readyState == 4) {
                    if (objeto.status == 200) {
                        document.getElementById(Options.ajaxContent).innerHTML = objeto.responseText;
                        $("#" + Options.ajaxContent).html(objeto.responseText);
                        setHtmlStatusContent('<div>' + _HtmlStatusContent + '</div>');
                        setHtmlStatusContentClass(Options.hscOutClass);
                        HtmlStatusContent.find("div").corner("4px");
                    }
                }
            }


            this.cargaInicio = function(context, url, strFbList, strSubAng, strTitleName, strTitleEmail, arrayWarnings, strMenSave, strMenWait, strMenAviso, strMenSaveOk, ok, modal, typeAngel, idFacebookAngel, uidAngel, uidPublic, titlePostFacebook, subtitlePostFacebook, bodyPostFacebook) {
                titleFbList = strFbList;
                titleAngelSettAng = strSubAng;
                titleName = strTitleName;
                titleEmail = strTitleEmail;
                menSave = strMenSave;
                menWait = strMenWait;
                menAviso = strMenAviso;
                menSaveOk = strMenSaveOk;
                menWarnings = new Array();
                menWarnings = arrayWarnings.split(";");

                if (!_AjaxFlagMenuItem.hasClass(Options.onClickClass)) {
                    muestraLoader(menSave, menWait);
                    setIcon(_onClickIcon);
                    setAjaxFlagMenuItemClass(Options.onClickClass);
                    setHtmlStatusContentClass(Options.hscOutClass);
                    if (LastSelectedItem != null) {
                        LastSelectedItem.setOnOutStatus();
                    }
                    _AjaxFlagMenuItem.corner("4px");
                    var objeto = $.ajax({
                        url: url,
                        type: 'POST',
                        async: true,
                        success: function() {
                            cargarobjeto(objeto);
                            cargarPagina(_data, strFbList, strSubAng);
                        },
                        complete: function() {
                            if (ok != "0") {
                                if (ok == "1") {
                                    if (typeAngel == 'F' && idFacebookAngel != null && uidAngel != null && uidPublic != null) {
                                        loadFeedDialog(context, idFacebookAngel, uidAngel, uidPublic, titlePostFacebook, subtitlePostFacebook, bodyPostFacebook);
                                    } else {
                                        lanzarModal('../SNSAngelGuardFB/infoMessage.jsp?typeInfo=0&infoMessage=' + menSaveOk, 750, 350);
                                    }
                                } else if (ok == "8") {
                                    var msg = menWarnings[8];
                                    lanzarModal('../SNSAngelGuardFB/infoMessage.jsp?typeInfo=2&infoMessage=' + msg, 750, 350);
                                } else if (ok == "6") {
                                    var msg = menWarnings[6];
                                    cerrarLoader();
                                    lanzarModal('../SNSAngelGuardFB/infoMessage.jsp?typeInfo=0&infoMessage=' + msg, 750, 350);
                                } else if (ok == "5") {
                                    var msg = menWarnings[5];
                                    lanzarModal('../SNSAngelGuardFB/infoMessage.jsp?typeInfo=0&infoMessage=' + msg, 750, 350);
                                } else if (ok == "12") {
                                    var msg = menWarnings[12];
                                    lanzarModal('../SNSAngelGuardFB/infoMessage.jsp?typeInfo=2&infoMessage=' + msg, 750, 350);
                                }
                            }else{
                                if(isCompatibleNavigator() == false){
                                    var msg = menWarnings[13];
                                    lanzarModal('../SNSAngelGuardFB/infoMessage.jsp?typeInfo=1&infoMessage=' + msg, 750, 400);
                                }
                            }

                            loadAngelSelects($("#hdAngels").val());
                            pintarTablaConGoogle($('#hdAngelsGoogleSelected').val(), '');
                            loadContactsEd(menSave, menWait);
                            habilitarGuardar();
                            cerrarLoader();
                        }
                    });


                }
            }

            _AjaxFlagMenuItem.click(function() {
                if ($("#hdAngels").val() == '' && $("#hdAngelsGoogleSelected").val() == '' && $("#hdAngelsEd").val() == '' && _url == '../SNSAngelGuardFB/settingsSNSAngelGuard_Vigilants.jsp') {
                    lanzarModal('../SNSAngelGuardFB/infoMessage.jsp?typeInfo=1&infoMessage=' + menAviso, 750, 350);
                } else {
                    if (!_AjaxFlagMenuItem.hasClass(Options.onClickClass)) {

                        muestraLoader(menSave, menWait);
                        setIcon(_onClickIcon);
                        setAjaxFlagMenuItemClass(Options.onClickClass);
                        setHtmlStatusContentClass(Options.hscOutClass);
                        if (LastSelectedItem != null) {
                            LastSelectedItem.setOnOutStatus();
                        }
                        _AjaxFlagMenuItem.corner("4px");
                        Carga(_url, false, titleFbList, titleAngelSettAng, menSave, menWait);
                    }
                }
            });
        }
        ;

        var Caption = $("<li>" + Options.Caption + "</li>");
        Caption.addClass(Options.CaptionClass);
        var iTems = new Array();
        var AjaxFlagMenu = $("<ul></ul>");
        AjaxFlagMenu.css("list-style", "none");
        AjaxFlagMenu.append(Caption);
        this.add = function(_Options) {
            var item = new AjaxFlagMenuItem(_Options.Title, _Options.onOutIcon, _Options.onClickIcon, _Options.HtmlSatusContent, _Options.url, _Options.data);
            item.setOnOutStatus();
            iTems.push(item);
            AjaxFlagMenu.append(item.jQueryObject);
            return item;
        };

        AjaxFlagMenu.mousemove(function() {
            for (var i = 0; i < iTems.length; i++) {
                if (iTems[i].isClicked()) {
                    LastSelectedItem = iTems[i];
                    break;
                }
            }
        });
        $(this).append(AjaxFlagMenu);
        return this;
    };

})($, document);
